<html>
<head>
    <style type="text/css">
    <!--
        body {
            font-family: Helvetica, Tahoma, Arial;
            font-size: 12px;
        }

        #text_frame {
            font-size: 10px;
            display: block;
            width: 100%;
            height: 90%;
            border: 1px solid gray;
        }
    -->
    </style>
    <script>
        function $(id) { return document.getElementById(id) };

        // Initialize XMLHTTPRequest handle
        var xmlhttp = false;
        var running = false;
        var current_line = 0;
        var updateInterval = 1000;

        /*@cc_on @*/
        /*@if (@_jscript_version >= 5)
        // JScript gives us Conditional compilation, we can cope with old IE versions.
        // and security blocked creation of the objects.
         try {
          xmlhttp = new ActiveXObject("Msxml2.XMLHTTP");
         } catch (e) {
          try {
           xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
          } catch (E) {
           xmlhttp = false;
          }
         }
        @end @*/

        if (!xmlhttp && typeof XMLHttpRequest!='undefined') {
            try {
                xmlhttp = new XMLHttpRequest();
            } catch (e) {
                xmlhttp=false;
            }
        }

        if (!xmlhttp && window.createRequest) {
            try {
                xmlhttp = window.createRequest();
            } catch (e) {
                xmlhttp=false;
            }
        }

        function start_tail() {
            if(!running) {
                running = true;
                load_lines();
            }
            $("start_button").disabled = true;
            $("stop_button").disabled = false;
        }

        function stop_tail() {
            running = false;
            $("start_button").disabled = false;
            $("stop_button").disabled = true;
        }


        function add_lines(text) {
            iframe_window = $("text_frame").contentWindow;

            text_box = iframe_window.document.getElementById("text_box");

            if(text != "") {
                text_box.innerHTML += text + '\n';
                current_line += text.split('\n').length 
            }

            if($("autoscroll").value) {
                iframe_window.scrollTo(0, iframe_window.document.body.scrollHeight);    
            }

            setTimeout(load_lines, updateInterval);
        }

        function load_lines() {
            if(!running) {
                return;
            }
    
            xmlhttp.open("GET", "http://HOST_ADDRESS/tail?file=FILE_NAME&start_line=" + current_line, true);
            xmlhttp.onreadystatechange = function() {
                if (xmlhttp.readyState == 4) {
                    add_lines(xmlhttp.responseText);
                }         
            }
            xmlhttp.send(null);
        }

    </script>
</head>
<body>
    <!-- Controls -->
    File: <span id="file_name">FILE_NAME</span>
    <div style="float:right">
    <button id="start_button" onClick="start_tail()">Start tail -f</button>
    <button id="stop_button" disabled="true" onClick="stop_tail()">Stop</button>
    <input id="autoscroll" type="checkbox"/>Autoscroll</input>
    </div>

    <!-- Text frame -->
    <iframe id="text_frame"></iframe>

    <script>
        <!-- Creating <pre> tag inside the iframe -->
        text_box = $("text_frame").contentWindow.document.createElement("pre");
        text_box.id = "text_box";
        $("text_frame").contentWindow.document.body.appendChild(text_box);
    </script>
</body>
</html>
